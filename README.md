# DummyMessenger

# Стек:
 - python 3.10
 - FastAPI
 - Postgresql
 - SQLAlchemy
 - httpx
 - uvicorn

# Установка:

Клонируйте репозиторий к себе на компьютер:  

`
https://github.com/AleksSpace/DummyMessenger.git
`

# Запуск:
Запуск локально через терминал:
 - откройте первый терминал в корневой папке приложения (там где файл main.py)
 - введите команду ``` uvicorn main:app --reload --port 8002 ``` (сервер запуститься по адресу ` http://127.0.0.1:8002 `)
 - откройте второй терминал в корневой папке приложения (там где файл main.py)
 - введите команду ``` uvicorn main:app --reload --port 8003 ``` (сервер запуститься по адресу ` http://127.0.0.1:8003 `)
 - в папке client, в файле config_client.py, в переменную SERVER_REPLICAS впишите эти два адреса в список
 - откройте третий терминал и запустите клиент командой ``` python .\client\send_request.py ```
в третьем терминале, после завершения программы вы увидите вывод:
```
Total time for 5000 requests: общее кол-во секунд
Time per request: секунд на 1 запрос           
Requests per second: запросов в секунду
```
Чтобы проверить, что нет дубликатов, воспользуйтесь приложением PgAdmin, например, или подключитесь к БД через терминал.
И введите команду:
```
SELECT sender, user_message_count, COUNT(*)
FROM messages
GROUP BY sender, user_message_count
HAVING COUNT(*) > 1;
```
Если вернется пустой ответ, значит дубликатов нет.

Чтобы проверить ответ от одного запроса, перейдите по адресу ` http://127.0.0.1:8002/docs `  
и сделайте запрос через интерактивную документацию.

в ответ вернётся:
```
[
  {
    "id": 0,                                     - порядковый номер сообщения
    "sender": "string",                          - Имя отправителя
    "text": "string",                            - Текст сообщения
    "created_at": "2023-10-04T09:56:58.084Z",    - Время отправки сообщения
    "user_message_count": 0                      - Кол-во сообщений отправленных этим отправителем
  }
]
```

Запуск в Docker:
- перейдите в директорию приложения
- в корневой папке (там где находится файл docker-compose.yml), в терминале, выполните команду ``` docker-compose up ```  
Соберутся Docker контейнеры и начнут отправляться запросы.  
Результат работы вы можете увидеть в приложении Docker Desktop, или через терминал, введя команду:
``` docker logs -f dummymessenger-client-1 ```.  
Чтобы проверить, что нет дубликатов, воспользуйтесь приложением PgAdmin, например, или подключитесь к БД через терминал.  
И введите команду:
```
SELECT sender, user_message_count, COUNT(*)
FROM messages
GROUP BY sender, user_message_count
HAVING COUNT(*) > 1;
```
Если вернется пустой ответ, значит дубликатов нет.
